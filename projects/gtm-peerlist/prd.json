{
  "branchName": "ralph/gtm-peerlist",
  "userStories": [
    {
      "id": "1.1",
      "category": "technical",
      "story": "Create database schema for agencies, case studies, testimonials, team members, inquiries, and analytics tables",
      "steps": [
        "Create agencies table with all fields from PRD",
        "Create case_studies table with metrics JSONB field",
        "Create testimonials table with rating constraint",
        "Create team_members table",
        "Create inquiries table",
        "Create agency_views and saved_agencies tables",
        "Add foreign key constraints and indexes"
      ],
      "acceptance": "All tables created with proper constraints, migrations run successfully",
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "1.2",
      "category": "technical",
      "story": "Define TypeScript types and Zod schemas for all entities",
      "steps": [
        "Create Agency type and schemas (create, update)",
        "Create CaseStudy type and schemas",
        "Create Testimonial type and schemas",
        "Create TeamMember type and schemas",
        "Create Inquiry type and schemas",
        "Create GTMService and Industry enums"
      ],
      "acceptance": "All types exported, Zod schemas validate correctly",
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "2.1",
      "category": "technical",
      "story": "Implement agency CRUD API endpoints",
      "steps": [
        "Implement agencies.create mutation",
        "Implement agencies.update mutation",
        "Implement agencies.getBySlug query",
        "Implement agencies.getMine query",
        "Add slug generation and validation logic"
      ],
      "acceptance": "All agency endpoints work with proper authorization checks",
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "2.2",
      "category": "technical",
      "story": "Implement agency listing and search API",
      "steps": [
        "Implement agencies.list query with pagination",
        "Add filter support for industries, services, locations",
        "Add sorting by relevance, newest, most_viewed",
        "Implement search on name, tagline, description"
      ],
      "acceptance": "List returns paginated results, filters and search work correctly",
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "2.3",
      "category": "technical",
      "story": "Implement case study CRUD API endpoints",
      "steps": [
        "Implement caseStudies.create mutation",
        "Implement caseStudies.update mutation",
        "Implement caseStudies.delete mutation",
        "Implement caseStudies.get and caseStudies.list queries",
        "Add agency ownership verification"
      ],
      "acceptance": "Case study endpoints work with proper ownership checks",
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "2.4",
      "category": "technical",
      "story": "Implement testimonial CRUD API endpoints",
      "steps": [
        "Implement testimonials.create mutation",
        "Implement testimonials.update mutation",
        "Implement testimonials.delete mutation",
        "Implement testimonials.list query",
        "Handle case study linking"
      ],
      "acceptance": "Testimonial endpoints work with agency ownership verification",
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "2.5",
      "category": "technical",
      "story": "Implement team member CRUD API endpoints",
      "steps": [
        "Implement teamMembers.create mutation",
        "Implement teamMembers.update mutation",
        "Implement teamMembers.delete mutation",
        "Implement teamMembers.list query with ordering"
      ],
      "acceptance": "Team member endpoints work with display ordering",
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "2.6",
      "category": "technical",
      "story": "Implement inquiry API endpoints",
      "steps": [
        "Implement inquiries.create mutation (public)",
        "Implement inquiries.list query (protected)",
        "Implement inquiries.markResponded mutation"
      ],
      "acceptance": "Inquiries can be created publicly, listed by owner only",
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "2.7",
      "category": "technical",
      "story": "Implement analytics tracking API",
      "steps": [
        "Implement analytics.trackView mutation",
        "Implement analytics.get query",
        "Track viewer info (user_id, referrer, section)"
      ],
      "acceptance": "Profile views are tracked, analytics retrievable by owner",
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "3.1",
      "category": "functional",
      "story": "Implement agency slug generation and validation",
      "steps": [
        "Convert name to lowercase, replace special chars with hyphens",
        "Check uniqueness, append number if needed",
        "Block reserved slugs (new, edit, admin, api)"
      ],
      "acceptance": "Slugs are unique, URL-safe, and reserved words are blocked",
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "3.2",
      "category": "functional",
      "story": "Implement image upload for agencies",
      "steps": [
        "Add upload endpoint for agency logos",
        "Add upload endpoint for case study images",
        "Add upload endpoint for team member photos",
        "Validate file type and size (5MB max)"
      ],
      "acceptance": "Images upload successfully, invalid files rejected",
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "3.3",
      "category": "functional",
      "story": "Implement inquiry notification system",
      "steps": [
        "Create inquiry notification worker",
        "Send email to agency owner on new inquiry",
        "Include inquiry details in notification"
      ],
      "acceptance": "Agency owner receives email when inquiry is submitted",
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "4.1",
      "category": "ui",
      "story": "Build public agency directory page",
      "steps": [
        "Create /agencies page layout",
        "Implement search input component",
        "Implement filter dropdowns (industry, services, location)",
        "Implement sorting dropdown",
        "Add pagination controls"
      ],
      "acceptance": "Directory displays agencies with working search and filters",
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "4.2",
      "category": "ui",
      "story": "Build AgencyCard component for directory listing",
      "steps": [
        "Display logo, name, tagline",
        "Show services and industries as tags",
        "Show location and verified badge",
        "Add View Profile link"
      ],
      "acceptance": "Card displays all agency info, links to profile",
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "4.3",
      "category": "ui",
      "story": "Build public agency profile page",
      "steps": [
        "Create /agencies/[slug] page",
        "Display agency header with logo, name, tagline, contact button",
        "Add tab navigation (About, Case Studies, Testimonials, Team)",
        "Implement About section with services and industries"
      ],
      "acceptance": "Profile page displays agency info with tab navigation",
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "4.4",
      "category": "ui",
      "story": "Build case studies section for profile page",
      "steps": [
        "Create CaseStudyCard component",
        "Display title, client, industry, duration",
        "Show metrics with visual formatting",
        "Add expandable detail view"
      ],
      "acceptance": "Case studies display with metrics, expandable for details",
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "4.5",
      "category": "ui",
      "story": "Build testimonials section for profile page",
      "steps": [
        "Create TestimonialCard component",
        "Display quote, client name, role, company",
        "Show star rating if present",
        "Show client photo if available"
      ],
      "acceptance": "Testimonials display with client info and rating",
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "4.6",
      "category": "ui",
      "story": "Build team section for profile page",
      "steps": [
        "Create TeamMemberCard component",
        "Display photo, name, role",
        "Show social links (LinkedIn, Twitter)"
      ],
      "acceptance": "Team members display with photos and social links",
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "4.7",
      "category": "ui",
      "story": "Build contact/inquiry form modal",
      "steps": [
        "Create inquiry form with required fields",
        "Add company name, size, budget, timeline fields",
        "Implement form validation",
        "Show success message on submission"
      ],
      "acceptance": "Form submits inquiry, shows success/error states",
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "5.1",
      "category": "ui",
      "story": "Build agency dashboard page",
      "steps": [
        "Create /app/[teamSlug]/agencies page",
        "Display overview stats (views, inquiries, case studies)",
        "Add quick action buttons",
        "Show recent inquiries list"
      ],
      "acceptance": "Dashboard shows agency stats and recent activity",
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "5.2",
      "category": "ui",
      "story": "Build agency profile edit form",
      "steps": [
        "Create edit page with all agency fields",
        "Add logo upload with preview",
        "Implement multi-select for services and industries",
        "Add social link inputs"
      ],
      "acceptance": "All agency fields editable, logo uploads work",
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "5.3",
      "category": "ui",
      "story": "Build case study creation/edit form",
      "steps": [
        "Create form with client info section",
        "Add challenge, solution, results text areas",
        "Implement dynamic metrics input (add/remove)",
        "Add date picker for timeline",
        "Add cover image upload"
      ],
      "acceptance": "Case studies can be created and edited with all fields",
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "5.4",
      "category": "ui",
      "story": "Build testimonial creation/edit form",
      "steps": [
        "Create form with client info fields",
        "Add quote textarea",
        "Add star rating selector",
        "Add optional case study link dropdown"
      ],
      "acceptance": "Testimonials can be created and edited with all fields",
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "5.5",
      "category": "ui",
      "story": "Build team member management UI",
      "steps": [
        "Create team member list with drag-and-drop ordering",
        "Add team member form (name, role, bio, photo)",
        "Implement photo upload",
        "Add social link inputs"
      ],
      "acceptance": "Team members can be added, edited, reordered, and deleted",
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "5.6",
      "category": "ui",
      "story": "Build inquiries management page",
      "steps": [
        "Create inquiries list page",
        "Display inquiry details (subject, message, company info)",
        "Add status filter (pending, responded)",
        "Implement mark as responded action"
      ],
      "acceptance": "Inquiries viewable and manageable by agency owner",
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "6.1",
      "category": "functional",
      "story": "Implement agency registration flow",
      "steps": [
        "Add agency creation to user onboarding or settings",
        "Validate one agency per user limit",
        "Generate and validate slug on creation"
      ],
      "acceptance": "Users can create an agency, limited to one per account",
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "6.2",
      "category": "functional",
      "story": "Implement authorization checks",
      "steps": [
        "Verify agency ownership on all protected mutations",
        "Return 403 for unauthorized access attempts",
        "Validate user can only edit their own agency"
      ],
      "acceptance": "Users can only modify their own agency data",
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "6.3",
      "category": "functional",
      "story": "Implement case study visibility toggle",
      "steps": [
        "Add is_public toggle to case study form",
        "Filter private case studies from public profile view",
        "Show all case studies in agency dashboard"
      ],
      "acceptance": "Agencies can hide case studies from public view while managing them privately",
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "6.4",
      "category": "functional",
      "story": "Implement testimonial-case study linking",
      "steps": [
        "Add case study dropdown to testimonial form",
        "Display linked case study on testimonial card",
        "Handle unlinking when case study is deleted"
      ],
      "acceptance": "Testimonials can optionally link to a case study, links are maintained correctly",
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "7.1",
      "category": "functional",
      "story": "Implement edge case handling for duplicate slugs",
      "steps": [
        "Check slug uniqueness on agency creation",
        "Suggest alternative slugs by appending numbers",
        "Block reserved slugs (new, edit, admin, api)"
      ],
      "acceptance": "Duplicate slugs show error with suggestions, reserved slugs blocked",
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "7.2",
      "category": "functional",
      "story": "Handle case study deletion with linked testimonials",
      "steps": [
        "Check for linked testimonials before deletion",
        "Show warning modal listing affected testimonials",
        "Unlink testimonials (set case_study_id to null) on deletion"
      ],
      "acceptance": "User warned before deletion, testimonials preserved but unlinked",
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "7.3",
      "category": "functional",
      "story": "Handle inquiries to inactive agencies",
      "steps": [
        "Check agency status before showing inquiry form",
        "Show warning message on inactive agency profiles",
        "Allow inquiry submission but flag as to inactive agency",
        "Notify agency owner via email regardless of status"
      ],
      "acceptance": "Users warned about inactive status, inquiries still accepted",
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "7.4",
      "category": "functional",
      "story": "Implement empty search results UX",
      "steps": [
        "Display friendly message when no agencies match filters",
        "Suggest broadening search criteria",
        "Show option to clear all filters",
        "Display featured or popular agencies as alternatives"
      ],
      "acceptance": "Empty state is helpful and guides users to find results",
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "8.1",
      "category": "technical",
      "story": "Implement image optimization worker",
      "steps": [
        "Create image-optimization worker triggered on upload",
        "Resize images to appropriate dimensions",
        "Compress images while maintaining quality",
        "Generate multiple sizes for responsive display"
      ],
      "acceptance": "Uploaded images are automatically optimized and resized",
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "8.2",
      "category": "technical",
      "story": "Implement agency verification email worker",
      "steps": [
        "Create verification email worker",
        "Send email when agency is created",
        "Send notification when verification status changes",
        "Include relevant agency information in email"
      ],
      "acceptance": "Agency owners receive verification-related emails automatically",
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "8.3",
      "category": "technical",
      "story": "Implement analytics aggregation worker",
      "steps": [
        "Create daily cron job for analytics aggregation",
        "Calculate total views, unique visitors per agency",
        "Compute trends (daily, weekly, monthly)",
        "Store aggregated data for dashboard display"
      ],
      "acceptance": "Analytics dashboard shows accurate aggregated metrics",
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "4.8",
      "category": "ui",
      "story": "Display agency verification badge",
      "steps": [
        "Create VerifiedBadge component with tooltip",
        "Display badge on AgencyCard in directory",
        "Display badge on agency profile header",
        "Style badge distinctively"
      ],
      "acceptance": "Verified agencies display badge consistently across all views",
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "5.7",
      "category": "ui",
      "story": "Add View Public Profile link to dashboard",
      "steps": [
        "Add 'View Public' button to agency dashboard header",
        "Link to /agencies/[slug] route",
        "Open in new tab to preserve dashboard context"
      ],
      "acceptance": "Agency owners can easily preview their public profile from dashboard",
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "5.8",
      "category": "ui",
      "story": "Build case study list management page",
      "steps": [
        "Create /app/[teamSlug]/agencies/case-studies page",
        "Display list of case studies with title, client, date",
        "Add edit and delete action buttons",
        "Show featured/public status indicators"
      ],
      "acceptance": "Agency owners can view and manage all their case studies",
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "5.9",
      "category": "ui",
      "story": "Build testimonial list management page",
      "steps": [
        "Create /app/[teamSlug]/agencies/testimonials page",
        "Display list of testimonials with client, quote preview",
        "Add edit and delete action buttons",
        "Show featured/verified status indicators"
      ],
      "acceptance": "Agency owners can view and manage all their testimonials",
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "6.5",
      "category": "functional",
      "story": "Implement metrics JSON validation",
      "steps": [
        "Validate metrics JSONB structure on case study save",
        "Ensure key-value pairs are strings or numbers",
        "Show clear error message for invalid format",
        "Provide example format in UI"
      ],
      "acceptance": "Invalid metrics format rejected with helpful error message",
      "priority": 3,
      "passes": false,
      "notes": ""
    }
  ]
}
